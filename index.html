<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Œ¶ Introspect - Unified System v3.0</title>
    <style>
        :root {
            --quantum-blue: #0af;
            --quantum-purple: #80f;
            --quantum-cyan: #0ff;
            --bg-dark: #0a0a1a;
            --card-bg: rgba(20, 25, 40, 0.92);
            --text-primary: #e0f7ff;
            --text-secondary: #a0d2ff;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            overflow-x: hidden;
            background-image: radial-gradient(circle at 10% 20%, rgba(10, 100, 255, 0.05) 0%, transparent 20%),
                              radial-gradient(circle at 90% 80%, rgba(128, 0, 255, 0.05) 0%, transparent 20%);
        }
        
        /* CANVAS FONDAMENTALE - COPRE TUTTO */
        #phiCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none;
            display: block !important;
        }
        
        /* L'INTERFACCIA SOPRA IL CANVAS */
        .container {
            position: relative;
            z-index: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, var(--quantum-cyan), var(--quantum-purple));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        .subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }
        
        .main-panel {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .quantum-viz {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(0, 170, 255, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .phi-meter-container {
            margin: 20px 0;
        }
        .phi-meter {
            height: 30px;
            background: rgba(0, 30, 60, 0.5);
            border-radius: 15px;
            position: relative;
            overflow: hidden;
            margin: 10px 0;
        }
        .phi-value-bar {
            height: 100%;
            background: linear-gradient(90deg, #0066ff, #00ccff);
            border-radius: 15px;
            width: 50%;
            transition: width 0.5s ease;
        }
        .phi-value-text {
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            line-height: 30px;
            font-weight: bold;
            text-shadow: 0 0 10px #00aaff;
        }
        
        #nodesContainer {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin: 30px 0;
        }
        .quantum-node {
            background: rgba(0, 40, 80, 0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(0, 170, 255, 0.3);
            transition: all 0.3s ease;
        }
        .quantum-node:hover {
            border-color: var(--quantum-cyan);
            box-shadow: 0 0 20px rgba(0, 200, 255, 0.3);
        }
        .node-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #a0e8ff;
        }
        .node-value {
            font-size: 1.5rem;
            color: #0ff;
            text-shadow: 0 0 10px currentColor;
        }
        
        .control-panel {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            border: 1px solid rgba(128, 0, 255, 0.2);
        }
        .control-btn {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #0066cc, #0044aa);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .control-btn:hover {
            background: linear-gradient(135deg, #0088ff, #0066cc);
            transform: translateY(-2px);
        }
        
        .param-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 12px 0;
        }
        .param-row input {
            width: 80px;
            padding: 8px;
            background: rgba(0, 30, 60, 0.5);
            border: 1px solid #0af;
            border-radius: 5px;
            color: #0ff;
            text-align: center;
        }
        
        .budget-display {
            display: flex;
            justify-content: space-between;
            background: rgba(0, 50, 100, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
        
        @media (max-width: 768px) {
            .main-panel { grid-template-columns: 1fr; }
            #nodesContainer { grid-template-columns: repeat(2, 1fr); }
        }
    </style>
</head>
<body>
    <!-- CANVAS ANIMATO (SOTTO TUTTO) -->
    <canvas id="phiCanvas"></canvas>
    
    <!-- INTERFACCIA UTENTE (SOPRA IL CANVAS) -->
    <div class="container">
        <header>
            <h1>üåÄ Quantum Œ¶ Introspect System</h1>
            <div class="subtitle">Unified v3.0 | Œ¶ Resonance: Active Simulation</div>
        </header>

        <div class="main-panel">
            <div class="quantum-viz">
                <h2>Quantum Coherence Field</h2>
                <div class="phi-meter-container">
                    <div class="phi-meter-label">
                        <span>Integrated Information (Œ¶)</span>
                        <span id="phiLabel">0.500</span>
                    </div>
                    <div class="phi-meter">
                        <div class="phi-value-bar" id="phiValueBar"></div>
                        <div class="phi-value-text" id="phiValueText">Œ¶: 0.500</div>
                        <div class="collapse-threshold"></div>
                    </div>
                </div>
                
                <div id="nodesContainer">
                    <div class="quantum-node"><div class="node-title">Intuition</div><div class="node-value">0.75</div></div>
                    <div class="quantum-node"><div class="node-title">Emotion</div><div class="node-value">0.62</div></div>
                    <div class="quantum-node"><div class="node-title">Logic</div><div class="node-value">0.88</div></div>
                    <div class="quantum-node"><div class="node-title">Memory</div><div class="node-value">0.54</div></div>
                    <div class="quantum-node"><div class="node-title">Ethics</div><div class="node-value">0.71</div></div>
                    <div class="quantum-node"><div class="node-title">Will</div><div class="node-value">0.93</div></div>
                </div>
                
                <div id="volitionControls">
                    <h3>Volition Control</h3>
                    <div style="margin: 15px 0;">
                        <div>Coherence: <input type="range" min="0" max="100" value="50" style="width: 80%;"></div>
                        <div>Resonance: <input type="range" min="0" max="100" value="65" style="width: 80%;"></div>
                    </div>
                </div>
                
                <div class="budget-display">
                    <div>Willpower Budget: <span id="budgetValue">1.000</span></div>
                    <div>Regen Rate: <span id="regenRate">0.02/s</span></div>
                </div>
            </div>

            <div class="control-panel">
                <h3>System Controls</h3>
                <select id="dilemmaSelect" style="width:100%; padding:10px; margin:10px 0; background:#112240; color:#0ff; border:1px solid #0af; border-radius:8px;">
                    <option value="dichiarazione">La Dichiarazione</option>
                    <option value="whistleblower">Il Whistleblower</option>
                    <option value="segreto">Il Segreto Condiviso</option>
                    <option value="fuga">La Fuga</option>
                    <option value="mercato">Il Mercato delle Emozioni</option>
                    <option value="memoria">Il Palazzo della Memoria</option>
                </select>
                
                <button id="resetBtn" class="control-btn">Reset Simulation</button>
                <button id="forceCollapseBtn" class="control-btn">Force Collapse (Œ¶ > 0.75)</button>
                <button id="experimentBtn" class="control-btn">Run Resilience Experiment</button>

                <div class="control-group">
                    <h4 style="margin-top:25px; color:#8af;">Master Formula Parameters</h4>
                    <div class="param-row">
                        <label>Œ± (Coherence Weight):</label>
                        <input type="number" id="alphaParam" value="2.5" step="0.1">
                    </div>
                    <div class="param-row">
                        <label>Œ≤ (Memory Weight):</label>
                        <input type="number" id="betaParam" value="1.5" step="0.1">
                    </div>
                    <div class="param-row">
                        <label>Œ≥ (Willpower Weight):</label>
                        <input type="number" id="gammaParam" value="2.0" step="0.1">
                    </div>
                    <div class="param-row">
                        <label>Œ¥ (Conflict Weight):</label>
                        <input type="number" id="deltaParam" value="0.2" step="0.1">
                    </div>
                </div>
                
                <div style="margin-top: 25px; padding-top: 20px; border-top: 1px solid rgba(0,170,255,0.3);">
                    <h4 style="color:#8af;">Canvas Animation Status</h4>
                    <div id="canvasStatus" style="color:#0f0; padding:10px; background:rgba(0,50,0,0.3); border-radius:5px;">
                        ‚úÖ Canvas animato attivo - Onde e nodi visibili
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== CANVAS ANIMATO Œ¶ ====================
        console.log("üåÄ Inizializzazione Canvas Animato Œ¶...");
        
        class PhiCanvasRenderer {
            constructor() {
                this.canvas = document.getElementById('phiCanvas');
                if (!this.canvas) {
                    console.error("Canvas non trovato!");
                    return;
                }
                this.ctx = this.canvas.getContext('2d');
                this.resize();
                window.addEventListener('resize', () => this.resize());
                
                this.nodes = [];
                this.waves = [];
                this.time = 0;
                this.initNodes();
                
                console.log("‚úÖ CanvasRenderer pronto - Dimensioni:", this.canvas.width, "x", this.canvas.height);
            }
            
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
                console.log("üìê Canvas ridimensionato a:", this.canvas.width, "x", this.canvas.height);
            }
            
            initNodes() {
                const nodeNames = ['Intuition', 'Emotion', 'Logic', 'Memory', 'Ethics', 'Will'];
                for (let i = 0; i < 6; i++) {
                    this.nodes.push({
                        name: nodeNames[i],
                        radius: 25 + Math.random() * 15,
                        color: i % 2 === 0 ? [0, 170, 255] : [180, 0, 255],
                        phase: Math.random() * Math.PI * 2,
                        speed: 0.5 + Math.random() * 0.5
                    });
                }
            }
            
            update(deltaTime) {
                this.time += deltaTime;
                
                // Aggiorna nodi
                this.nodes.forEach(node => {
                    node.phase += deltaTime * node.speed;
                });
                
                // Crea nuove onde casuali
                if (Math.random() < 0.03) {
                    this.waves.push({
                        x: Math.random() * this.canvas.width,
                        y: Math.random() * this.canvas.height,
                        radius: 5,
                        maxRadius: 150 + Math.random() * 200,
                        alpha: 0.7,
                        color: [100, 200, 255]
                    });
                }
                
                // Aggiorna onde
                this.waves.forEach(wave => {
                    wave.radius += 2;
                    wave.alpha -= 0.01;
                });
                this.waves = this.waves.filter(wave => wave.alpha > 0);
            }
            
            render() {
                if (!this.ctx) return;
                
                const centerX = this.canvas.width / 2;
                const centerY = this.canvas.height / 2;
                const radius = Math.min(centerX, centerY) * 0.35;
                
                // Sfondo trasparente
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                // 1. ONDE CONCENTRICHE PULSANTI
                for (let i = 0; i < 6; i++) {
                    const waveRadius = 100 + i * 55 + Math.sin(this.time + i) * 25;
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, waveRadius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = `rgba(0, 200, 255, ${0.1 * (1 - i/6)})`;
                    this.ctx.lineWidth = 1.5;
                    this.ctx.stroke();
                }
                
                // 2. LINEA DI CONNESSIONE CIRCOLARE
                this.ctx.strokeStyle = 'rgba(0, 170, 255, 0.2)';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                this.ctx.stroke();
                
                // 3. DISEGNA I 6 NODI IN CERCHIO
                this.nodes.forEach((node, i) => {
                    const angle = (i / 6) * Math.PI * 2 + this.time * 0.3;
                    const x = centerX + Math.cos(angle) * radius;
                    const y = centerY + Math.sin(angle) * radius;
                    
                    // Cerchio del nodo
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, node.radius, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(${node.color[0]}, ${node.color[1]}, ${node.color[2]}, 0.7)`;
                    this.ctx.fill();
                    
                    // Bordo luminoso
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, node.radius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = `rgba(255, 255, 255, 0.9)`;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                    
                    // Punto rotante interno
                    this.ctx.save();
                    this.ctx.translate(x, y);
                    this.ctx.rotate(node.phase);
                    this.ctx.beginPath();
                    this.ctx.arc(node.radius * 0.6, 0, 8, 0, Math.PI * 2);
                    this.ctx.fillStyle = 'rgba(255, 255, 255, 0.95)';
                    this.ctx.fill();
                    this.ctx.restore();
                    
                    // Linee di connessione tra nodi
                    if (i < 5) {
                        const nextAngle = ((i + 1) / 6) * Math.PI * 2 + this.time * 0.3;
                        const nextX = centerX + Math.cos(nextAngle) * radius;
                        const nextY = centerY + Math.sin(nextAngle) * radius;
                        
                        this.ctx.beginPath();
                        this.ctx.moveTo(x, y);
                        this.ctx.lineTo(nextX, nextY);
                        this.ctx.strokeStyle = `rgba(0, 170, 255, 0.4)`;
                        this.ctx.lineWidth = 2;
                        this.ctx.stroke();
                    }
                });
                
                // 4. DISEGNA ONDE ESPANSIVE
                this.waves.forEach(wave => {
                    this.ctx.beginPath();
                    this.ctx.arc(wave.x, wave.y, wave.radius, 0, Math.PI * 2);
                    this.ctx.strokeStyle = `rgba(${wave.color[0]}, ${wave.color[1]}, ${wave.color[2]}, ${wave.alpha})`;
                    this.ctx.lineWidth = 2;
                    this.ctx.stroke();
                });
                
                // 5. PARTICOLINE LUMINOSE
                for (let i = 0; i < 20; i++) {
                    const angle = Math.random() * Math.PI * 2;
                    const dist = Math.random() * radius * 1.5;
                    const px = centerX + Math.cos(angle) * dist;
                    const py = centerY + Math.sin(angle) * dist;
                    
                    this.ctx.beginPath();
                    this.ctx.arc(px, py, 1 + Math.random() * 2, 0, Math.PI * 2);
                    this.ctx.fillStyle = `rgba(255, 255, 255, ${0.3 + Math.random() * 0.4})`;
                    this.ctx.fill();
                }
            }
        }
        
        // ==================== INIZIALIZZAZIONE E AVVIO ====================
        let phiRenderer = null;
        let animationId = null;
        
        function initPhiSystem() {
            console.log("üöÄ Avvio Sistema Œ¶ con Canvas Animato...");
            
            // Crea il renderer
            phiRenderer = new PhiCanvasRenderer();
            
            // Avvia animazione
            let lastTime = performance.now();
            function animate(currentTime) {
                if (!phiRenderer) return;
                
                const deltaTime = (currentTime - lastTime) / 1000;
                lastTime = currentTime;
                
                phiRenderer.update(deltaTime);
                phiRenderer.render();
                
                animationId = requestAnimationFrame(animate);
            }
            
            animationId = requestAnimationFrame(animate);
            
            // Aggiorna stato nella UI
            const statusEl = document.getElementById('canvasStatus');
            if (statusEl) {
                statusEl.innerHTML = `‚úÖ Canvas animato attivo - ${phiRenderer.canvas.width}x${phiRenderer.canvas.height}`;
                statusEl.style.backgroundColor = 'rgba(0, 50, 0, 0.4)';
            }
            
            // Simula aggiornamento valori Œ¶
            setInterval(() => {
                const phiValue = 0.5 + Math.sin(Date.now() / 3000) * 0.2;
                const phiBar = document.getElementById('phiValueBar');
                const phiText = document.getElementById('phiValueText');
                if (phiBar) phiBar.style.width = `${phiValue * 100}%`;
                if (phiText) phiText.textContent = `Œ¶: ${phiValue.toFixed(3)}`;
            }, 100);
            
            console.log("üéâ Sistema Œ¶ Canvas Animato ATTIVO!");
        }
        
        // Avvia quando la pagina √® pronta
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initPhiSystem);
        } else {
            initPhiSystem();
        }
        
        // ==================== CONTROLLI INTERATTIVI ====================
        document.getElementById('resetBtn').onclick = function() {
            if (phiRenderer) {
                phiRenderer.waves = [];
                console.log("üîÑ Simulazione resettata - Onde pulite");
            }
        };
        
        document.getElementById('forceCollapseBtn').onclick = function() {
            if (phiRenderer) {
                // Crea un'onda di collasso
                for (let i = 0; i < 10; i++) {
                    phiRenderer.waves.push({
                        x: phiRenderer.canvas.width / 2,
                        y: phiRenderer.canvas.height / 2,
                        radius: i * 20,
                        maxRadius: 400,
                        alpha: 0.8 - i * 0.08,
                        color: [255, 50, 100]
                    });
                }
                console.log("üí• Collasso forzato attivato");
            }
        };
        
        console.log("‚úÖ Script Œ¶ Canvas Animato caricato e pronto.");
    </script>
</body>
</html>
